<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROCK PAPER SCISSORS</title>
    <style>
        body {
            font-size: 30px;
            background-color: black;
            color: white;
            font-family: Arial;
            font-weight: bold;
        }
        .move {
            border-radius: 90px;
            border-width: 3px;
            border-color: white;
            background-color: transparent;
        }
        .move_icon {
            width: 70px;
            padding: 12px 10px;
        }
        .move_icons {
            width: 50px;
        }
        .rps {
            display: flex;
            align-items: center;
            flex-direction: column;
        }
        .reset {
            font-size: large;
            padding: 8px 10px;
            color: white;
            background-color: red;
        }
        .buttons {
            display: flex;
            flex-direction: row;
        }
        .button1 {
            display: flex;
            flex-direction: row;
        }
        .autopl {
            margin-left: 5px;
            font-size: large;
            padding: 8px;
            width: 100px;
            background-color: green;
            color: white;
        }
        .js-result.win {
            color: green;
        }
        .js-result.lose {
            color: red;
        }
        .js-result.tie {
            color: white;
        }
    </style>
</head>
<body>
    <div class="rps">
        <p>Rock Paper Scissors</p>
        <div class="buttons">
            <button onclick="sendMove('rock')" class="move">
                <img src="image/Rock-emoji.png" class="move_icon">
            </button>
            <button onclick="sendMove('paper');" class="move">
                <img src="image/Paper-emoji.png" class="move_icon">
            </button>
            <button onclick="sendMove('scissors')" class="move">
                <img src="image/Scissors-emoji.png" class="move_icon">
            </button>
        </div>
        <p class="js-resultimg"></p>
        <p class="js-result"></p>
        <p class="js-score"></p>
        <div class="button1">
            <button onclick="resetScore()" class="reset">Reset button</button>
            <button class="autopl" onclick="autople(this);">Auto Play</button>
        </div>
        <div>
            <button onclick="setMode('computer')">Play Against Computer</button>
            <button onclick="setMode('human')">Play Against Human</button>
        </div>
        <p>Your Peer ID: <span id="my-peer-id"></span></p>
        <input type="text" id="peer-id-input" placeholder="Enter Peer ID to connect">
        <button onclick="connectToPeer()">Connect</button>
    </div>
    <script src="https://unpkg.com/peerjs@1.3.2/dist/peerjs.min.js"></script>
    <script>
        let peer = new Peer();
        let mode = 'computer'; // Default mode
        let conn;
        let localMove = null;
        let remoteMove = null;

        peer.on('open', id => {
            console.log('My peer ID is: ' + id);
            document.getElementById('my-peer-id').textContent = id;
        });

        peer.on('error', err => {
            console.error('PeerJS error:', err);
        });

        peer.on('connection', connection => {
            conn = connection;
            console.log('Connection received:', conn);
            conn.on('data', data => {
                console.log('Data received:', data);
                remoteMove = data.move;
                if (localMove !== null) {
                    playgame(localMove, remoteMove);
                }
            });
        });

        function connectToPeer() {
            const peerId = document.getElementById('peer-id-input').value;
            console.log('Attempting to connect to:', peerId);
            conn = peer.connect(peerId);
            conn.on('open', () => {
                console.log('Connected to: ' + peerId);
                conn.on('data', data => {
                    console.log('Data received:', data);
                    remoteMove = data.move;
                    if (localMove !== null) {
                        playgame(localMove, remoteMove);
                    }
                });
            });

            conn.on('error', err => {
                console.error('Connection error:', err);
            });
        }

        function sendMove(move) {
            if (mode === 'human') {
                if (conn && conn.open) {
                    console.log('Sending move:', move);
                    conn.send({ move: move });
                    localMove = move;
                    if (remoteMove !== null) {
                        playgame(localMove, remoteMove);
                    } else {
                        console.log('Waiting for opponent\'s move...');
                    }
                } else {
                    console.error('Connection is not open.');
                }
            } else {
                playgame(move, pickcomputermove());
            }
        }

        let score = JSON.parse(localStorage.getItem('score')) || {
            win: 0,
            lose: 0,
            tie: 0
        };

        function resetScore() {
            score = {
                win: 0,
                lose: 0,
                tie: 0
            };
            updateScore();
        }

        let autoPlayInterval;

        function autople(button) {
            if (button.innerHTML === "Auto Play") {
                button.innerHTML = "Stop";
                clearInterval(autoPlayInterval);

                autoPlayInterval = setInterval(function () {
                    const playermove = pickcomputermove();
                    playgame(playermove, pickcomputermove());
                    updateScore();
                    if (score.win >= 10 || score.lose >= 10) {
                        clearInterval(autoPlayInterval);
                    }
                }, 1000);
            } else {
                button.innerHTML = "Auto Play";
                clearInterval(autoPlayInterval);
            }
        }

        function playgame(localMove, remoteMove) {
            let result = "";
            if (localMove === "paper") {
                if (remoteMove === "rock") {
                    result = "You win";
                } else if (remoteMove === "scissors") {
                    result = "You lose";
                } else if (remoteMove === "paper") {
                    result = "It is a tie";
                }
            }
            if (localMove === 'rock') {
                if (remoteMove === 'rock') {
                    result = 'It is a tie';
                } else if (remoteMove === 'scissors') {
                    result = 'You win';
                } else if (remoteMove === 'paper') {
                    result = 'You lose';
                }
            }

            if (localMove === "scissors") {
                if (remoteMove === "rock") {
                    result = "You lose";
                } else if (remoteMove === "scissors") {
                    result = "It is a tie";
                } else if (remoteMove === "paper") {
                    result = "You win";
                }
            }

            if (result === "You win") {
                score.win += 1;
            } else if (result === "It is a tie") {
                score.tie += 1;
            } else if (result === "You lose") {
                score.lose += 1;
            }
            localStorage.setItem('score', JSON.stringify(score));
            displayResult(result);
            if (mode === 'computer') {
                document.querySelector('.js-score').innerHTML = `YOU: ${score.win} COMPUTER: ${score.lose}`;
                document.querySelector('.js-resultimg').innerHTML = `YOU: <img src="image/${localMove}-emoji.png" class="move_icons"> COMPUTER: <img src="image/${remoteMove}-emoji.png" class="move_icons">`;
            } else {
                document.querySelector('.js-score').innerHTML = `YOU: ${score.win} OPPONENT: ${score.lose}`;
                document.querySelector('.js-resultimg').innerHTML = `YOU: <img src="image/${localMove}-emoji.png" class="move_icons"> OPPONENT: <img src="image/${remoteMove}-emoji.png" class="move_icons">`;
            }

            // Reset moves after game logic
            localMove = null;
            remoteMove = null;
        }

        function setMode(selectedMode) {
            mode = selectedMode;
            console.log(`Mode set to: ${mode}`);
            resetScore(); // Reset score when changing modes
            updateScore(); // Update the score display
        }

        function pickcomputermove() {
            const randomNumber = Math.random();

            if (randomNumber >= 0 && randomNumber < 1 / 3) {
                return "rock";
            } else if (randomNumber >= 1 / 3 && randomNumber < 2 / 3) {
                return "paper";
            } else {
                return "scissors";
            }
        }

        function updateScore() {
            const scoreElement = document.querySelector('.js-score');
            scoreElement.textContent = `YOU: ${score.win}, ${mode === 'computer' ? 'COMPUTER' : 'OPPONENT'}: ${score.lose}`;
        }

        function displayResult(result) {
            const Element = document.querySelector('.js-result');
            Element.classList.remove('win', 'lose', 'tie');

            if (/win/i.test(result)) {
                Element.textContent = result;
                Element.classList.add('win');
            } else if (/lose/i.test(result)) {
                Element.textContent = result;
                Element.classList.add('lose');
            } else if (/tie/i.test(result)) {
                Element.textContent = result;
                Element.classList.add('tie');
            }
        }

        updateScore();
    </script>
</body>
</html>
